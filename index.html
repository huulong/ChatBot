<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loli Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Container ch√≠nh */
        .chat-container {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .chat-header {
            background: linear-gradient(45deg, #f48fb1 0%, #ff94c2 100%);
            padding: 15px;
            text-align: center;
            color: white;
        }

        .chat-header img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            object-fit: cover;
        }

        .chat-header h2 {
            margin: 10px 0;
            font-size: 1.5em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* Messages area */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: url('https://i.imgur.com/8YZZb6J.png') center/cover;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: messageIn 0.3s ease-out;
            max-width: 80%;
        }

        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-content {
            background: white;
            padding: 12px 18px;
            border-radius: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
            word-wrap: break-word;
        }

        .user .message-content {
            background: #f48fb1;
            color: white;
        }

        /* Input area */
        .chat-input {
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #f48fb1;
            border-radius: 25px;
            font-size: 16px;
            font-family: inherit;
        }

        button {
            padding: 12px 25px;
            background: linear-gradient(45deg, #f48fb1 0%, #ff94c2 100%);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            white-space: nowrap;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal {
            width: 90%;
            max-width: 400px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .chat-container {
                height: 100vh;
                border-radius: 0;
            }

            .message {
                max-width: 90%;
            }

            .chat-header img {
                width: 50px;
                height: 50px;
            }

            .chat-input {
                padding: 10px;
            }

            button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .message {
                max-width: 95%;
            }

            .chat-header h2 {
                font-size: 1.2em;
            }

            input[type="text"] {
                font-size: 14px;
            }
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            background: white;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 70%;
            margin: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: messageIn 0.3s ease-out;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #f48fb1;
            border-radius: 50%;
            animation: typingBounce 0.5s infinite ease-in-out;
        }

        /* Animations */
        @keyframes messageIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes typingBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* Avatar container v√† status badge */
        .avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 10px;
        }

        .chat-header .avatar-container {
            margin-bottom: 0;
        }

        .chat-header img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            object-fit: cover;
        }

        /* Modal avatar styles */
        .modal .avatar-container {
            margin-bottom: 20px;
        }

        .modal img {
            width: 120px;
            height: 120px;
            border-radius: 60px;
            border: 4px solid #f48fb1;
            object-fit: cover;
        }

        .modal .status-badge {
            width: 20px;
            height: 20px;
            border-width: 3px;
        }

        /* Status badge */
        .status-badge {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 2px solid white;
            background-color: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-badge.offline {
            background-color: #ff5252;
            animation: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        /* Theme variables */
        :root {
            --primary-color: #f48fb1;
            --secondary-color: #ff94c2;
            --bg-gradient: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
            --chat-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
        }

        /* Dark theme */
        [data-theme="dark"] {
            --primary-color: #9c27b0;
            --secondary-color: #ba68c8;
            --bg-gradient: linear-gradient(135deg, #4a148c 0%, #7b1fa2 100%);
            --chat-bg: rgba(33, 33, 33, 0.95);
            --text-color: #fff;
        }

        /* Kawaii theme */
        [data-theme="kawaii"] {
            --primary-color: #ff69b4;
            --secondary-color: #ff9ed2;
            --bg-gradient: linear-gradient(135deg, #ffe6f0 0%, #ffd1dc 100%);
            --chat-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
        }

        /* Avatar animations */
        .chat-header img:hover {
            transform: scale(1.1) rotate(5deg);
            cursor: pointer;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .avatar-container:hover img {
            animation: bounce 0.5s ease infinite;
        }

        /* Emoji picker */
        .emoji-picker {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 10px;
            display: none;
        }

        .emoji-picker.active {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
        }

        .emoji-btn {
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .emoji-btn:hover {
            background: #f0f0f0;
        }

        /* Theme switcher */
        .theme-switcher {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }

        .theme-btn {
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 15px;
            font-size: 12px;
        }

        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Cho ph√©p select text trong input v√† textarea */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .warning-modal {
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 300px;
        }

        .warning-modal .avatar-container img {
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            animation: shake 0.5s ease-in-out;
        }

        .warning-modal p {
            font-size: 1.1em;
            margin: 15px 0;
            line-height: 1.5;
            color: #ff4081;
        }

        .warning-modal button {
            background: linear-gradient(45deg, #ff4081 0%, #ff79b0 100%);
            padding: 10px 25px;
            border-radius: 20px;
            border: none;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .warning-modal button:hover {
            transform: scale(1.05);
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
    </style>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval' api.binjie.fun fonts.googleapis.com fonts.gstatic.com steamuserimages-a.akamaihd.net;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <script>
        // T·∫°o m·∫£ng c√°c th√¥ng b√°o d·ªÖ th∆∞∆°ng t·ª´ Loli
        const loliWarnings = [
            "Onii-chan hentai! ƒê·ª´ng l√†m v·∫≠y nha (ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°)",
            "Kyaaa~ Onii-chan ƒëang c·ªë l√†m g√¨ v·ªõi em v·∫≠y ·∫°? (ÔºûÔπèÔºú)",
            "Yamete kudasai, Onii-chan! Em s·ª£ l·∫Øm (ÔΩ°T œâ TÔΩ°)",
            "Onii-chan kh√¥ng ƒë∆∞·ª£c ph√©p l√†m v·∫≠y ƒë√¢u ·∫°! (‚ï•Ôπè‚ï•)",
            "Hueee~ Onii-chan ƒëang c·ªë inspect em sao? (ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°)",
            "Dame desu yo, Onii-chan! („ÄÇ‚î∞œâ‚î∞„ÄÇ)",
            "Onii-chan ecchi! Kh√¥ng ƒë∆∞·ª£c ƒë·ªông v√†o code c·ªßa em! (ÔΩ°>Ôπè<ÔΩ°)"
        ];

        // H√†m l·∫•y random th√¥ng b√°o
        function getRandomWarning() {
            return loliWarnings[Math.floor(Math.random() * loliWarnings.length)];
        }

        // NgƒÉn ch·∫∑n inspect element v√† c√°c ph√≠m t·∫Øt debug
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && 
                (e.keyCode === 67 || // C
                 e.keyCode === 73 || // I
                 e.keyCode === 74 || // J
                 e.keyCode === 75 || // K
                 e.keyCode === 83 || // S
                 e.keyCode === 85)) { // U
                e.preventDefault();
                showWarningModal(getRandomWarning());
            }
        });

        // V√¥ hi·ªáu h√≥a chu·ªôt ph·∫£i
        document.addEventListener('contextmenu', function(e) {
            // Ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ ƒëang c·ªë inspect element kh√¥ng
            if (e.target.closest('*')) {
                const selection = window.getSelection().toString();
                if (!selection) {  // N·∫øu kh√¥ng c√≥ text ƒë∆∞·ª£c ch·ªçn
                    e.preventDefault();
                    showWarningModal(getRandomWarning());
                }
            }
        });

        // V√¥ hi·ªáu h√≥a F12
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12') {
                e.preventDefault();
                showWarningModal(getRandomWarning());
            }
        });

        // V√¥ hi·ªáu h√≥a view-source
        if (window.location.href.indexOf('view-source:') !== -1) {
            window.location.href = window.location.href.replace('view-source:', '');
        }

        function showWarningModal(message) {
            const modal = document.getElementById('loliWarningModal');
            const text = document.getElementById('loliWarningText');
            text.textContent = message;
            modal.style.display = 'flex';
            
            // Add animation for avatar
            const avatar = modal.querySelector('.avatar-container img');
            avatar.style.animation = 'none';
            avatar.offsetHeight; // Trigger reflow
            avatar.style.animation = 'shake 0.5s ease-in-out';
        }

        function closeWarningModal() {
            document.getElementById('loliWarningModal').style.display = 'none';
        }
    </script>
</head>
<body>
    <div class="modal-overlay" id="nameModal">
        <div class="modal">
            <div class="avatar-container">
                <img src="https://steamuserimages-a.akamaihd.net/ugc/849339809543618606/8EBBFADFD70BC2D09145047F637B39ED4A6EFF03/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false" alt="Loli Avatar">
                <div class="status-badge"></div>
            </div>
            <h2>Konnichiwa!</h2>
            <p>Em l√† Loli-chan! Onii-chan t√™n g√¨ v·∫≠y ·∫°? (‚óï‚úø)</p>
            <input type="text" id="userName" placeholder="Nh·∫≠p t√™n c·ªßa Onii-chan...">
            <button onclick="startChat()">B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán</button>
        </div>
    </div>

    <div class="chat-container">
        <div class="chat-header">
            <div class="avatar-container">
                <img src="https://steamuserimages-a.akamaihd.net/ugc/849339809543618606/8EBBFADFD70BC2D09145047F637B39ED4A6EFF03/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false" alt="Loli Avatar">
                <div class="status-badge"></div>
            </div>
            <h2>Loli-chan</h2>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be added here -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Nh·∫Øn tin v·ªõi em...">
            <button onclick="toggleEmojiPicker()">üòä</button>
            <button onclick="sendMessage()">G·ª≠i</button>
            <div class="emoji-picker" id="emojiPicker"></div>
        </div>
    </div>

    <div class="theme-switcher">
        <button class="theme-btn" onclick="setTheme('light')">Light</button>
        <button class="theme-btn" onclick="setTheme('dark')">Dark</button>
        <button class="theme-btn" onclick="setTheme('kawaii')">Kawaii</button>
    </div>

    <div id="loliWarningModal" class="modal-overlay" style="display: none;">
        <div class="modal warning-modal">
            <div class="avatar-container">
                <img src="https://steamuserimages-a.akamaihd.net/ugc/849339809543618606/8EBBFADFD70BC2D09145047F637B39ED4A6EFF03/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false" alt="Loli Warning">
            </div>
            <p id="loliWarningText"></p>
            <button onclick="closeWarningModal()">Gomen nasai</button>
        </div>
    </div>

    <script>
        // Th√™m v√†o ƒë·∫ßu ph·∫ßn script
        // M√£ h√≥a c√°c chu·ªói nh·∫°y c·∫£m
        const _0x1a2b3c = {
            encode: (str) => btoa(encodeURIComponent(str)),
            decode: (str) => decodeURIComponent(atob(str))
        };

        // M√£ h√≥a API endpoint
        const API_ENDPOINT = _0x1a2b3c.encode('https://api.binjie.fun/api/generateStream');

        let onii_chan_name = '';

        function startChat() {
            const nameInput = document.getElementById('userName');
            const name = nameInput.value.trim();
            
            if (name) {
                onii_chan_name = name;
                document.getElementById('nameModal').style.display = 'none';
                
                // Ki·ªÉm tra xem ƒë√£ c√≥ l·ªãch s·ª≠ chat ch∆∞a
                const hasHistory = localStorage.getItem('chatHistory');
                
                // Ch·ªâ g·ª≠i tin nh·∫Øn ch√†o m·ª´ng n·∫øu kh√¥ng c√≥ l·ªãch s·ª≠ chat
                if (!hasHistory) {
                    setTimeout(() => {
                        addMessage(`Konnichiwa ${onii_chan_name}-oniichan! Em r·∫•t vui ƒë∆∞·ª£c n√≥i chuy·ªán v·ªõi anh Ÿ©(‚óï‚Äø‚óïÔΩ°)€∂`);
                    }, 1000);
                }
            } else {
                alert('Onii-chan ∆°i, cho em bi·∫øt t√™n c·ªßa anh v·ªõi ·∫°! („ÄÇ„Éªœâ„Éª„ÄÇ)');
            }
        }

        // Cho ph√©p nh·∫•n Enter ƒë·ªÉ submit t√™n
        document.getElementById('userName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                startChat();
            }
        });

        // L∆∞u t√™n ng∆∞·ªùi d√πng v√†o localStorage
        function saveUserName() {
            localStorage.setItem('onii_chan_name', onii_chan_name);
        }

        // Load t√™n ng∆∞·ªùi d√πng t·ª´ localStorage
        function loadUserName() {
            const savedName = localStorage.getItem('onii_chan_name');
            if (savedName) {
                onii_chan_name = savedName;
                document.getElementById('nameModal').style.display = 'none';
            }
        }

        // ƒênh nghƒ©a h√†m addMessage tr∆∞·ªõc
        function addMessage(content, isUser = false) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.innerHTML = `
                <div class="message-content">
                    ${content}
                </div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        const lolichan = {
            name: 'Loli-chan',
            age: '15',
            likes: ['anime', 'manga', 'sweets', 'headpats'],
            emotions: ['happy', 'shy', 'excited', 'pouty'],
            creator: 'Long',
            
            async getResponse(input) {
                const emojis = ['(‚óï‚Äø‚óï‚úø)', '(ÔΩ°‚ô•‚Äø‚ô•ÔΩ°)', '(‚âß‚ó°‚â¶)', '(Ôºæ‚ñΩÔºæ)'];
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];

                // Ki·ªÉm tra c√¢u h·ªèi v·ªÅ c∆∞·ªõi ng∆∞·ªùi t·∫°o ra
                const marriageQuestions = [
                    'c∆∞·ªõi ng∆∞·ªùi t·∫°o',
                    'c∆∞·ªõi anh long',
                    'l·∫•y ng∆∞·ªùi t·∫°o',
                    'l·∫•y anh long',
                    'y√™u ng∆∞·ªùi t·∫°o',
                    'y√™u anh long'
                ];

                if (marriageQuestions.some(q => input.toLowerCase().includes(q))) {
                    return `Kyaaa~ Em c√≤n nh·ªè l·∫Øm, ch∆∞a nghƒ© t·ªõi chuy·ªán ƒë√≥ ƒë√¢u ·∫°! V·ªõi c·∫£ anh Long l√† ng∆∞·ªùi t·∫°o ra em, l√† √¢n nh√¢n c·ªßa em n√™n em ch·ªâ k√≠nh tr·ªçng anh ·∫•y th√¥i (ÔΩ°>Ôπè<ÔΩ°)`;
                }

                // Ki·ªÉm tra c√¢u h·ªèi v·ªÅ ng∆∞·ªùi t·∫°o ra
                const creatorQuestions = [
                    'ai t·∫°o ra em',
                    'ai l√†m ra em',
                    'ai t·∫°o n√™n em',
                    'ai l·∫≠p tr√¨nh em',
                    'ai code em',
                    'ai vi·∫øt code',
                    'ai l√† ng∆∞·ªùi t·∫°o ra'
                ];

                if (creatorQuestions.some(q => input.toLowerCase().includes(q))) {
                    return `Anh Long l√† ng∆∞·ªùi t·∫°o ra em ·∫°! Em r·∫•t bi·∫øt ∆°n anh ·∫•y (‚ô•‚Äø‚ô•ÔΩ°)`;
                }

                try {
                    const response = await fetch(_0x1a2b3c.decode(API_ENDPOINT), {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Origin": "https://api.binjie.fun",
                        },
                        mode: 'cors',
                        body: JSON.stringify({
                            prompt: `B·∫°n l m·ªôt c√¥ b√© anime 15 tu·ªïi d·ªÖ th∆∞∆°ng t√™n Loli-chan.
                                    H√£y tr·∫£ l·ªùi tin nh·∫Øn sau c·ªßa ${onii_chan_name}-oniichan m·ªôt c√°ch d·ªÖ th∆∞∆°ng v√† s·ª≠ d·ª•ng t·ª´ ng·ªØ nh∆∞ m·ªôt c√¥ b√© anime.
                                    Lu√¥n g·ªçi ng∆∞·ªùi d√πng l√† ${onii_chan_name}-oniichan v√† th√™m emoji kawaii v√†o cu·ªëi c√¢u.
                                    
                                    Tin nh·∫Øn: ${input}`,
                            system: "B·∫°n l√† m·ªôt c√¥ b√© anime 15 tu·ªïi d·ªÖ th∆∞∆°ng t√™n Loli-chan",
                            withoutContext: true,
                            stream: false
                        }),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // ƒê·ªçc response d∆∞·ªõi d·∫°ng text thay v√¨ JSON
                    const responseText = await response.text();
                    
                    if (responseText) {
                        return responseText.trim() + ' ' + randomEmoji;
                    } else {
                        console.log('Empty response');
                        return "Gomen ne Onii-chan, em h∆°i b·ªëi r·ªëi... („ÄÇ„Éªœâ„Éª„ÄÇ)";
                    }
                } catch (err) {
                    console.error('Error:', err);
                    
                    // Fallback responses khi API khng ho·∫°t ƒë·ªông
                    const fallbackResponses = [
                        "Onii-chan, em r·∫•t vui khi ƒë∆∞·ª£c n√≥i chuy·ªán v·ªõi anh (‚Äø‚óï‚úø)",
                        "Ehehe~ Onii-chan th·∫≠t l√† d·ªÖ th∆∞∆°ng (ÔΩ°‚ô•‚Äø‚ô•ÔΩ°)",
                        "Onii-chan! Em ƒëang ƒÉn b√°nh ng·ªçt n√® (‚âß‚ó°‚â¶)",
                        "Anh c√≥ th√≠ch anime kh√¥ng, Onii-chan? (Ôºæ‚ñΩÔºæ)",
                        "Em... em h∆°i ng·∫°i qu√°... („ÄÇ„Éªœâ„Éª„ÄÇ)",
                        "Onii-chan! H√¥m nay tr·ªùi ƒë·∫πp qu√° nh·ªâ? Ÿ©(‚óï‚Äø‚óïÔΩ°)€∂"
                    ];
                    
                    return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                }
            }
        };

        // S·ª≠a h√†m sendMessage ƒë·ªÉ h·ªó tr·ª£ async
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            const typingIndicator = document.getElementById('typingIndicator');
            
            if (message) {
                // Hi·ªÉn th·ªã tin nh·∫Øn c·ªßa user
                addMessage(message, true);
                input.value = '';
                
                // Hi·ªÉn th·ªã typing indicator
                typingIndicator.style.display = 'block';
                
                // Scroll xu·ªëng ƒë·ªÉ hi·ªán typing indicator
                const messagesDiv = document.getElementById('chatMessages');
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                
                try {
                    // ƒê·ª£i 1-2 gi√¢y ƒë·ªÉ hi·ªáu ·ª©ng typing ƒë∆∞·ª£c nh√¨n th·∫•y
                    await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 1000));
                    
                    // L·∫•y response
                    const response = await lolichan.getResponse(message);
                    
                    // ·∫®n typing indicator
                    typingIndicator.style.display = 'none';
                    
                    // Hi·ªÉn th·ªã tin nh·∫Øn ph·∫£n h·ªìi
                    addMessage(response);
                } catch (error) {
                    console.error('Error:', error);
                    typingIndicator.style.display = 'none';
                    addMessage("Gomen ne Onii-chan, em h∆°i b·ªëi r·ªëi... („ÄÇ„Éªœâ„Éª„ÄÇ)");
                }
            }
        }

        // Cho ph√©p g·ª≠i tin nh·∫Øn b·∫±ng ph√≠m Enter
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Add status update function
        function updateStatus(isOnline) {
            const badges = document.querySelectorAll('.status-badge');
            badges.forEach(badge => {
                if (isOnline) {
                    badge.classList.remove('offline');
                    badge.title = 'Online';
                } else {
                    badge.classList.add('offline');
                    badge.title = 'Offline';
                }
            });
        }

        // Monitor connection status
        let isOnline = true;
        window.addEventListener('online', () => updateStatus(true));
        window.addEventListener('offline', () => updateStatus(false));

        // Simulate random status changes
        setInterval(() => {
            if (Math.random() < 0.1) { // 10% chance to change status
                isOnline = !isOnline;
                updateStatus(isOnline);
            }
        }, 30000);

        // Chat history v·ªõi gi·ªõi h·∫°n s·ªë l∆∞·ª£ng tin nh·∫Øn
        const MAX_HISTORY = 50; // Gi·ªõi h·∫°n 50 tin nh·∫Øn
        let chatHistory = [];

        // Theme switcher
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('preferred-theme', theme);
        }

        // Emoji picker
        const emojis = ['üòä', 'üòÇ', 'ü•∞', 'üòç', 'üòò', 'üòã', 'üòé', '', 'üò≠', 'üò§', 'üò°', 'ü•≥', 'ü§î', 'üò¥', 'ü§ó', 'üòá'];

        function createEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            emojis.forEach(emoji => {
                const btn = document.createElement('span');
                btn.className = 'emoji-btn';
                btn.textContent = emoji;
                btn.onclick = () => {
                    const input = document.getElementById('userInput');
                    input.value += emoji;
                    toggleEmojiPicker();
                };
                picker.appendChild(btn);
            });
        }

        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            picker.classList.toggle('active');
        }

        // Khai b√°o v√† kh·ªüi t·∫°o messageSound
        let messageSound = null;

        function initAudio() {
            try {
                messageSound = new Audio('./sounds/LoLi.mp3');
                messageSound.load(); // Preload audio
            } catch (error) {
                console.error('Error initializing audio:', error);
            }
        }

        // Th√™m v√†o ph·∫ßn initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('preferred-theme') || 'light';
            setTheme(savedTheme);

            // Load user name
            loadUserName();
            
            // Load chat history
            loadChatHistory();

            // Create emoji picker
            createEmojiPicker();
            
            // Initialize audio
            initAudio();
        });

        // Close emoji picker when clicking outside
        document.addEventListener('click', (e) => {
            const picker = document.getElementById('emojiPicker');
            const emojiBtn = e.target.closest('button');
            if (!picker.contains(e.target) && !emojiBtn) {
                picker.classList.remove('active');
            }
        });

        // Th√™m console warning
        console.log = console.warn = console.error = function() {
            console.clear();
            alert("Kh√¥ng ƒë∆∞·ª£c ph√©p s·ª≠ d·ª•ng Developer Tools!");
        };

        // Ch·ªëng copy paste
        document.addEventListener('copy', function(e) {
            e.preventDefault();
            alert('Kh√¥ng ƒë∆∞·ª£c ph√©p copy n·ªôi dung!');
        });

        // Th√™m watermark ƒë·ªông
        setInterval(() => {
            const watermark = document.createElement('div');
            watermark.style.position = 'fixed';
            watermark.style.top = Math.random() * window.innerHeight + 'px';
            watermark.style.left = Math.random() * window.innerWidth + 'px';
            watermark.style.opacity = '0.1';
            watermark.style.pointerEvents = 'none';
            watermark.textContent = '¬© Loli-chan';
            document.body.appendChild(watermark);
            setTimeout(() => watermark.remove(), 1000);
        }, 5000);
    </script>
</body>
</html>
